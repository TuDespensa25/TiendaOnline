<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combos Temporales - Tu Despensa25</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="style-combos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="main-header">
            <div class="logo">
                <a href="index.html">
                    <img src="images/logo.svg" alt="Logo de TuDespensa.25">
                </a>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                </ul>
            </nav>
            <div class="header-cart">
                <a href="cart.html">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="contador-carrito" class="contador-carrito">0</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Contenido principal -->
    <main class="combos-container">
        <h1 class="combos-title">Combos Temporales üéÅ</h1>
        <p class="combos-description">Descubre nuestras ofertas especiales por tiempo limitado.</p>
        <div class="productos-recientes-container">
            <!-- Combo 1 -->
            <div class="producto" data-descripcion="Incluye frutas de temporada, bebidas refrescantes y snacks saludables.">
                <img src="images/helado.png" alt="Combo Verano" class="combo-image">
                <div class="combo-content">
                    <h3 class="combo-name">Combo Verano</h3>
                    <p class="combo-price">25.99</p>
                    <div class="combo-timer">
                        <p>Tiempo restante:</p>
                        <div class="timer" id="timer1">
                            <span class="days">00</span>d :
                            <span class="hours">00</span>h :
                            <span class="minutes">00</span>m :
                            <span class="seconds">00</span>s
                        </div>
                    </div>
                    <button class="btn-add-to-cart" data-id="1001">A√±adir al carrito</button>
                </div>
            </div>
            <!-- Combo 2 y Combo 3 (similar a Combo 1) -->
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="redes-sociales">
            <a class="btn-compartir" href="https://www.facebook.com/tuDespensa.25" target="_blank" aria-label="Facebook">
                <i class="fab fa-facebook-f"></i>
            </a>
            <a class="btn-compartir" href="https://www.instagram.com/tuDespensa.25" target="_blank" aria-label="Instagram">
                <i class="fab fa-instagram"></i>
            </a>
            <a class="btn-compartir" href="https://wa.me/5353933247" target="_blank" aria-label="WhatsApp">
                <i class="fab fa-whatsapp"></i>
            </a>
        </div>
        <p>&copy; 2025 @TuDespensa.25</p>
    </footer>

    <!-- Scripts -->
    <script>
        // Lista de combos (similar a la lista de productos en app.js)
        const combos = [
            {
                id: 1001,
                nombre: "Combo Verano",
                precio: 25.99,
                imagen: "helado.png",
                description: "Incluye frutas de temporada, bebidas refrescantes y snacks saludables.",
                categoria: "Combos",
                tiempoLimite: 24 * 60 * 60 * 1000, // 24 horas en milisegundos
            },
            // Agrega m√°s combos aqu√≠...
        ];

        // Variables globales y caching de elementos
        let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
        const contadorCarritoElem = document.getElementById("contador-carrito");

        // Funci√≥n para agregar un producto al carrito
        function agregarAlCarrito(id) {
            const producto = combos.find(p => p.id === id);
            if (!producto) return;
            const enCarrito = carrito.find(p => p.id === id);
            if (enCarrito) {
                enCarrito.cantidad++;
            } else {
                carrito.push({ ...producto, cantidad: 1 });
            }
            mostrarMensaje(`¬°${producto.nombre} agregado al carrito!`);
            actualizarContadorCarrito();
            guardarCarritoEnLocalStorage();
        }

        // Muestra mensaje emergente
        function mostrarMensaje(msg) {
            const mensajeElem = document.createElement("div");
            mensajeElem.className = "mensaje-carrito";
            mensajeElem.textContent = msg;
            document.body.appendChild(mensajeElem);
            setTimeout(() => mensajeElem.remove(), 2000);
        }

        // Actualiza el contador del carrito
        function actualizarContadorCarrito() {
            const total = carrito.reduce((acc, prod) => acc + prod.cantidad, 0);
            if (contadorCarritoElem) contadorCarritoElem.textContent = total;
        }

        // Guarda el carrito en localStorage
        function guardarCarritoEnLocalStorage() {
            localStorage.setItem("carrito", JSON.stringify(carrito));
        }

        // Funci√≥n para iniciar el contador de tiempo
        function iniciarContador(tiempoLimite, timerElem, boton) {
            const fechaLimite = new Date().getTime() + tiempoLimite;

            // Guardar la fecha l√≠mite en localStorage
            localStorage.setItem(`fechaLimite_${boton.dataset.id}`, fechaLimite);

            const intervalo = setInterval(() => {
                const ahora = new Date().getTime();
                const tiempoRestante = fechaLimite - ahora;

                if (tiempoRestante <= 0) {
                    clearInterval(intervalo);
                    timerElem.innerHTML = "¬°Oferta expirada!";
                    boton.disabled = true;
                    return;
                }

                const dias = Math.floor(tiempoRestante / (1000 * 60 * 60 * 24));
                const horas = Math.floor((tiempoRestante % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutos = Math.floor((tiempoRestante % (1000 * 60 * 60)) / (1000 * 60));
                const segundos = Math.floor((tiempoRestante % (1000 * 60)) / 1000);

                timerElem.innerHTML = `
                    <span class="days">${dias}</span>d :
                    <span class="hours">${horas}</span>h :
                    <span class="minutes">${minutos}</span>m :
                    <span class="seconds">${segundos}</span>s
                `;
            }, 1000);
        }

        // Asignar evento click a los botones de "A√±adir al carrito"
        document.addEventListener('DOMContentLoaded', () => {
            const botonesAgregar = document.querySelectorAll('.btn-add-to-cart');
            botonesAgregar.forEach((boton) => {
                const id = parseInt(boton.dataset.id, 10);
                const combo = combos.find(p => p.id === id);
                const timerElem = boton.closest('.combo-content').querySelector('.timer');

                // Verificar si ya hay una fecha l√≠mite guardada
                const fechaLimiteGuardada = localStorage.getItem(`fechaLimite_${id}`);
                const fechaLimite = fechaLimiteGuardada ? parseInt(fechaLimiteGuardada, 10) : new Date().getTime() + combo.tiempoLimite;

                // Iniciar el contador
                iniciarContador(fechaLimite - new Date().getTime(), timerElem, boton);

                // Asignar evento de clic al bot√≥n
                boton.addEventListener('click', () => {
                    agregarAlCarrito(id);
                });
            });

            // Actualizar el contador del carrito al cargar la p√°gina
            actualizarContadorCarrito();
        });
    </script>
</body>
</html>